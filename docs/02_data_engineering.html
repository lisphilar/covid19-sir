<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data engineering &mdash; CovsirPhy  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/lisphilar/covid19-sir/master/docs/logo/covsirphy_favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SIR-derived ODE models" href="03_ode.html" />
    <link rel="prev" title="Data preparation" href="01_data_preparation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="https://raw.githubusercontent.com/lisphilar/covid19-sir/master/docs/logo/covsirphy_logo_100.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.27.0-gamma
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">CovsirPhy introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="markdown/INSTALLATION.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_data_preparation.html">Data preparation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data engineering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#1.-Data-cleaning">1. Data cleaning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#2.-Data-transformation">2. Data transformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#3.-Arithmetic-operations">3. Arithmetic operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#4.-EDA-at-a-geospatial-layer">4. EDA at a geospatial layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#5.-Data-subsetting-for-a-location-and-data-complement">5. Data subsetting for a location and data complement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#5.1-Subsetting">5.1 Subsetting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#5.2-Details-of-data-complement">5.2 Details of data complement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#5.3-Recovery-period">5.3 Recovery period</a></li>
<li class="toctree-l3"><a class="reference internal" href="#5.4-Alias-of-subsets">5.4 Alias of subsets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#7.-EDA-of-subset">7. EDA of subset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#7.1-Alias-of-variables">7.1 Alias of variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#7.2-Line-plot">7.2 Line plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#7.3-Scatter-plot">7.3 Scatter plot</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="03_ode.html">SIR-derived ODE models</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_phase_dependent.html">Phase-dependent SIR models</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_scenario_analysis.html">Scenario analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_prediction.html">ODE parameter prediction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API references</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="covsirphy.html">covsirphy package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">General</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="markdown/TERM.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="CODE_OF_CONDUCT.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="SECURITY.html">Security policy of CovsirPhy</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contribution guideline</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CovsirPhy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Data engineering</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p><a class="reference external" href="https://mybinder.org/v2/gh/lisphilar/covid19-sir/HEAD?labpath=example%2F02_data_engineering.ipynb"><img alt="Binder" src="https://mybinder.org/badge_logo.svg" /></a></p>
<div class="section" id="Data-engineering">
<h1>Data engineering<a class="headerlink" href="#Data-engineering" title="Permalink to this heading"></a></h1>
<p>With <a class="reference external" href="https://github.com/lisphilar/covid19-sir/blob/master/example/01_data_preparation.ipynb">Data preparation tutorial</a>, we prepared datasets (geospatial time-series data) to analyze. As the next step of data engineering, we will perform the followings here.</p>
<ol class="arabic simple">
<li><p>Data cleaning</p></li>
<li><p>Data transformation</p></li>
<li><p>Arithmetic operations</p></li>
<li><p>EDA at a geospatial layer</p></li>
<li><p>Data subsetting for a location and data complement</p></li>
<li><p>EDA of subset</p></li>
</ol>
<p>Note that EDA = explanatory data analysis</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">covsirphy</span> <span class="k">as</span> <span class="nn">cs</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">cs</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;2.27.0-gamma&#39;
</pre></div></div>
</div>
<p>We will use the recommended datasets at country-level data as an example.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">DataEngineer</span><span class="p">()</span>
<span class="n">eng</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
<span class="n">eng</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 222070 entries, 0 to 222069
Data columns (total 33 columns):
 #   Column                               Non-Null Count   Dtype
---  ------                               --------------   -----
 0   ISO3                                 222070 non-null  category
 1   Province                             222070 non-null  category
 2   City                                 222070 non-null  category
 3   Date                                 222070 non-null  datetime64[ns]
 4   Cancel_events                        173893 non-null  object
 5   Confirmed                            200691 non-null  object
 6   Contact_tracing                      173829 non-null  object
 7   Country                              219452 non-null  string
 8   Fatal                                184285 non-null  object
 9   Gatherings_restrictions              173937 non-null  object
 10  Information_campaigns                173902 non-null  object
 11  Internal_movement_restrictions       173958 non-null  object
 12  International_movement_restrictions  173953 non-null  object
 13  Mobility_grocery_and_pharmacy        117506 non-null  object
 14  Mobility_parks                       117326 non-null  object
 15  Mobility_residential                 117183 non-null  object
 16  Mobility_retail_and_recreation       117577 non-null  object
 17  Mobility_transit_stations            118495 non-null  object
 18  Mobility_workplaces                  118932 non-null  object
 19  Population                           218483 non-null  object
 20  Product                              116920 non-null  string
 21  Recovered                            71604 non-null   object
 22  School_closing                       173962 non-null  object
 23  Stay_home_restrictions               173917 non-null  object
 24  Stringency_index                     173860 non-null  object
 25  Testing_policy                       173865 non-null  object
 26  Tests                                85553 non-null   object
 27  Transport_closing                    173935 non-null  object
 28  Vaccinated_full                      47952 non-null   object
 29  Vaccinated_once                      50509 non-null   object
 30  Vaccinations                         53183 non-null   object
 31  Vaccinations_boosters                26167 non-null   object
 32  Workplace_closing                    173939 non-null  object
dtypes: category(3), datetime64[ns](1), object(27), string(2)
memory usage: 51.7+ MB
</pre></div></div>
</div>
<div class="section" id="1.-Data-cleaning">
<h2>1. Data cleaning<a class="headerlink" href="#1.-Data-cleaning" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">DataEngineer().clean()</span></code> performs the following data cleaning functionalities. By applying a list of strings to <code class="docutils literal notranslate"><span class="pre">kinds</span></code> argument (eg. <code class="docutils literal notranslate"><span class="pre">kinds=[&quot;resample&quot;]</span></code>), we can specify the cleaning method(s).</p>
<ul class="simple">
<li><p>“convert_date”: Convert dtype of date column to pandas.Timestamp.</p></li>
<li><p>“resample”: Resample records with dates.</p></li>
<li><p>“fillna”: Fill NA values with ‘-’ (layers) and the previous values and 0.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
<span class="n">eng</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 222135 entries, 0 to 222134
Data columns (total 33 columns):
 #   Column                               Non-Null Count   Dtype
---  ------                               --------------   -----
 0   ISO3                                 222135 non-null  category
 1   Province                             222135 non-null  category
 2   City                                 222135 non-null  category
 3   Date                                 222135 non-null  datetime64[ns]
 4   Cancel_events                        222135 non-null  Int64
 5   Confirmed                            222135 non-null  Int64
 6   Contact_tracing                      222135 non-null  Int64
 7   Country                              222135 non-null  object
 8   Fatal                                222135 non-null  Int64
 9   Gatherings_restrictions              222135 non-null  Int64
 10  Information_campaigns                222135 non-null  Int64
 11  Internal_movement_restrictions       222135 non-null  Int64
 12  International_movement_restrictions  222135 non-null  Int64
 13  Mobility_grocery_and_pharmacy        222135 non-null  Int64
 14  Mobility_parks                       222135 non-null  Int64
 15  Mobility_residential                 222135 non-null  Int64
 16  Mobility_retail_and_recreation       222135 non-null  Int64
 17  Mobility_transit_stations            222135 non-null  Int64
 18  Mobility_workplaces                  222135 non-null  Int64
 19  Population                           222135 non-null  Int64
 20  Product                              222135 non-null  object
 21  Recovered                            222135 non-null  Int64
 22  School_closing                       222135 non-null  Int64
 23  Stay_home_restrictions               222135 non-null  Int64
 24  Stringency_index                     222135 non-null  Float64
 25  Testing_policy                       222135 non-null  Int64
 26  Tests                                222135 non-null  Int64
 27  Transport_closing                    222135 non-null  Int64
 28  Vaccinated_full                      222135 non-null  Int64
 29  Vaccinated_once                      222135 non-null  Int64
 30  Vaccinations                         222135 non-null  Int64
 31  Vaccinations_boosters                222135 non-null  Int64
 32  Workplace_closing                    222135 non-null  Int64
dtypes: Float64(1), Int64(26), category(3), datetime64[ns](1), object(2)
memory usage: 57.4+ MB
</pre></div></div>
</div>
</div>
<div class="section" id="2.-Data-transformation">
<h2>2. Data transformation<a class="headerlink" href="#2.-Data-transformation" title="Permalink to this heading"></a></h2>
<p>Transform all registered data, calculating the number of susceptible and infected cases. This is required to analyze real data with SIR-derived models.</p>
<ul class="simple">
<li><p>Susceptible = Population - Confirmed</p></li>
<li><p>Infected = Confirmed - Fatal - Recovered</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">main_variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Population&quot;</span><span class="p">,</span> <span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;Infected&quot;</span><span class="p">,</span> <span class="s2">&quot;Fatal&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
<span class="n">eng</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="n">main_variables</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ISO3</th>
      <th>Province</th>
      <th>City</th>
      <th>Date</th>
      <th>Population</th>
      <th>Susceptible</th>
      <th>Confirmed</th>
      <th>Infected</th>
      <th>Fatal</th>
      <th>Recovered</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>222130</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-12</td>
      <td>14439018</td>
      <td>14182130</td>
      <td>256888</td>
      <td>168298</td>
      <td>5596</td>
      <td>82994</td>
    </tr>
    <tr>
      <th>222131</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-13</td>
      <td>14439018</td>
      <td>14182114</td>
      <td>256904</td>
      <td>168314</td>
      <td>5596</td>
      <td>82994</td>
    </tr>
    <tr>
      <th>222132</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-14</td>
      <td>14439018</td>
      <td>14182079</td>
      <td>256939</td>
      <td>168349</td>
      <td>5596</td>
      <td>82994</td>
    </tr>
    <tr>
      <th>222133</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-15</td>
      <td>14439018</td>
      <td>14182079</td>
      <td>256939</td>
      <td>168349</td>
      <td>5596</td>
      <td>82994</td>
    </tr>
    <tr>
      <th>222134</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-16</td>
      <td>14439018</td>
      <td>14182079</td>
      <td>256939</td>
      <td>168349</td>
      <td>5596</td>
      <td>82994</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Recalculation of “Population” and “Confirmed” can be performed with <code class="docutils literal notranslate"><span class="pre">DataEngineer().inverse_transform()</span></code>, if necessary. (No impact with this example data.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">()</span>
<span class="n">eng</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="n">main_variables</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ISO3</th>
      <th>Province</th>
      <th>City</th>
      <th>Date</th>
      <th>Population</th>
      <th>Susceptible</th>
      <th>Confirmed</th>
      <th>Infected</th>
      <th>Fatal</th>
      <th>Recovered</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>222130</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-12</td>
      <td>14439018</td>
      <td>14182130</td>
      <td>256888</td>
      <td>168298</td>
      <td>5596</td>
      <td>82994</td>
    </tr>
    <tr>
      <th>222131</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-13</td>
      <td>14439018</td>
      <td>14182114</td>
      <td>256904</td>
      <td>168314</td>
      <td>5596</td>
      <td>82994</td>
    </tr>
    <tr>
      <th>222132</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-14</td>
      <td>14439018</td>
      <td>14182079</td>
      <td>256939</td>
      <td>168349</td>
      <td>5596</td>
      <td>82994</td>
    </tr>
    <tr>
      <th>222133</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-15</td>
      <td>14439018</td>
      <td>14182079</td>
      <td>256939</td>
      <td>168349</td>
      <td>5596</td>
      <td>82994</td>
    </tr>
    <tr>
      <th>222134</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-16</td>
      <td>14439018</td>
      <td>14182079</td>
      <td>256939</td>
      <td>168349</td>
      <td>5596</td>
      <td>82994</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="3.-Arithmetic-operations">
<h2>3. Arithmetic operations<a class="headerlink" href="#3.-Arithmetic-operations" title="Permalink to this heading"></a></h2>
<p>We can perform arithmetic operations to add new columns.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.diff(column,</span> <span class="pre">suffix=&quot;_diff&quot;,</span> <span class="pre">freq=&quot;D&quot;)</span></code>: Calculate daily new cases with “f(x&gt;0) = F(x) - F(x-1), x(0) = 0 when F is cumulative numbers”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.add(columns,</span> <span class="pre">new=None,</span> <span class="pre">fill_value=0)</span></code>: Calculate element-wise addition with pandas.DataFrame.sum(axis=1), X1 + X2 + X3 +…</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.mul(columns,</span> <span class="pre">new=None,</span> <span class="pre">fill_value=0)</span></code>: Calculate element-wise multiplication with pandas.DataFrame.product(axis=1), X1 * X2 * X3 *…</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.sub(minuend,</span> <span class="pre">subtrahend,</span> <span class="pre">new=None,</span> <span class="pre">fill_value=0)</span></code>: Calculate element-wise subtraction with pandas.Series.sub(), minuend - subtrahend.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.div(columns,</span> <span class="pre">new=None,</span> <span class="pre">fill_value=0)</span></code>: Calculate element-wise floating division with pandas.Series.div(), numerator / denominator.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.assign(**kwargs))</span></code>: Assign a new column with pandas.DataFrame.assign().</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Diff</span>
<span class="n">eng</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;_diff&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<span class="n">eng</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed_diff&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ISO3</th>
      <th>Province</th>
      <th>City</th>
      <th>Date</th>
      <th>Confirmed</th>
      <th>Confirmed_diff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>222130</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-12</td>
      <td>256888</td>
      <td>18</td>
    </tr>
    <tr>
      <th>222131</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-13</td>
      <td>256904</td>
      <td>16</td>
    </tr>
    <tr>
      <th>222132</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-14</td>
      <td>256939</td>
      <td>35</td>
    </tr>
    <tr>
      <th>222133</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-15</td>
      <td>256939</td>
      <td>0</td>
    </tr>
    <tr>
      <th>222134</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-16</td>
      <td>256939</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Addition</span>
<span class="n">eng</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Fatal&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">])</span>
<span class="n">eng</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Fatal&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">,</span> <span class="s2">&quot;Fatal+Recovered&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ISO3</th>
      <th>Province</th>
      <th>City</th>
      <th>Date</th>
      <th>Fatal</th>
      <th>Recovered</th>
      <th>Fatal+Recovered</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>222130</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-12</td>
      <td>5596</td>
      <td>82994</td>
      <td>88590</td>
    </tr>
    <tr>
      <th>222131</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-13</td>
      <td>5596</td>
      <td>82994</td>
      <td>88590</td>
    </tr>
    <tr>
      <th>222132</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-14</td>
      <td>5596</td>
      <td>82994</td>
      <td>88590</td>
    </tr>
    <tr>
      <th>222133</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-15</td>
      <td>5596</td>
      <td>82994</td>
      <td>88590</td>
    </tr>
    <tr>
      <th>222134</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-16</td>
      <td>5596</td>
      <td>82994</td>
      <td>88590</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Multiplication</span>
<span class="n">eng</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">])</span>
<span class="n">eng</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed*Recovered&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ISO3</th>
      <th>Province</th>
      <th>City</th>
      <th>Date</th>
      <th>Confirmed</th>
      <th>Recovered</th>
      <th>Confirmed*Recovered</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>222130</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-12</td>
      <td>256888</td>
      <td>82994</td>
      <td>21320162672</td>
    </tr>
    <tr>
      <th>222131</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-13</td>
      <td>256904</td>
      <td>82994</td>
      <td>21321490576</td>
    </tr>
    <tr>
      <th>222132</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-14</td>
      <td>256939</td>
      <td>82994</td>
      <td>21324395366</td>
    </tr>
    <tr>
      <th>222133</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-15</td>
      <td>256939</td>
      <td>82994</td>
      <td>21324395366</td>
    </tr>
    <tr>
      <th>222134</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-16</td>
      <td>256939</td>
      <td>82994</td>
      <td>21324395366</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Division</span>
<span class="n">eng</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">numerator</span><span class="o">=</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="n">denominator</span><span class="o">=</span><span class="s2">&quot;Tests&quot;</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="s2">&quot;Positive_rate&quot;</span><span class="p">)</span>
<span class="c1"># Assignment of new a new column</span>
<span class="n">eng</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;Positive_rate_%&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;Positive_rate&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">})</span>
<span class="n">eng</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Tests&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;Positive_rate_%&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ISO3</th>
      <th>Province</th>
      <th>City</th>
      <th>Date</th>
      <th>Tests</th>
      <th>Confirmed</th>
      <th>Positive_rate_%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>222130</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-12</td>
      <td>2379907</td>
      <td>256888</td>
      <td>10.794035</td>
    </tr>
    <tr>
      <th>222131</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-13</td>
      <td>2379907</td>
      <td>256904</td>
      <td>10.794708</td>
    </tr>
    <tr>
      <th>222132</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-14</td>
      <td>2379907</td>
      <td>256939</td>
      <td>10.796178</td>
    </tr>
    <tr>
      <th>222133</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-15</td>
      <td>2379907</td>
      <td>256939</td>
      <td>10.796178</td>
    </tr>
    <tr>
      <th>222134</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-16</td>
      <td>2379907</td>
      <td>256939</td>
      <td>10.796178</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="4.-EDA-at-a-geospatial-layer">
<h2>4. EDA at a geospatial layer<a class="headerlink" href="#4.-EDA-at-a-geospatial-layer" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">DataEngineer().layer()</span></code> returns the data at the selected layer in the date range.</p>
<p>Arguments:</p>
<ul class="simple">
<li><p>geo (tuple(list[str] or tuple(str) or str) or str or None): location names to specify the layer or None (the top level)</p></li>
<li><p>start_date (str or None): start date, like 22Jan2020</p></li>
<li><p>end_date (str or None): end date, like 01Feb2020</p></li>
<li><p>variables (list[str] or None): list of variables to add or None (all available columns)</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span><span class="o">.</span><span class="n">layer</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ISO3</th>
      <th>Province</th>
      <th>City</th>
      <th>Date</th>
      <th>Cancel_events</th>
      <th>Confirmed</th>
      <th>Confirmed*Recovered</th>
      <th>Confirmed_diff</th>
      <th>Contact_tracing</th>
      <th>Country</th>
      <th>...</th>
      <th>Stringency_index</th>
      <th>Susceptible</th>
      <th>Testing_policy</th>
      <th>Tests</th>
      <th>Transport_closing</th>
      <th>Vaccinated_full</th>
      <th>Vaccinated_once</th>
      <th>Vaccinations</th>
      <th>Vaccinations_boosters</th>
      <th>Workplace_closing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>222130</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-12</td>
      <td>1</td>
      <td>256888</td>
      <td>21320162672</td>
      <td>18</td>
      <td>1</td>
      <td>Zimbabwe</td>
      <td>...</td>
      <td>53.7</td>
      <td>14182130</td>
      <td>3</td>
      <td>2379907</td>
      <td>1</td>
      <td>4730503</td>
      <td>6416614</td>
      <td>12161598</td>
      <td>1014481</td>
      <td>1</td>
    </tr>
    <tr>
      <th>222131</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-13</td>
      <td>1</td>
      <td>256904</td>
      <td>21321490576</td>
      <td>16</td>
      <td>1</td>
      <td>Zimbabwe</td>
      <td>...</td>
      <td>53.7</td>
      <td>14182114</td>
      <td>3</td>
      <td>2379907</td>
      <td>1</td>
      <td>4730503</td>
      <td>6416614</td>
      <td>12161598</td>
      <td>1014481</td>
      <td>1</td>
    </tr>
    <tr>
      <th>222132</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-14</td>
      <td>1</td>
      <td>256939</td>
      <td>21324395366</td>
      <td>35</td>
      <td>1</td>
      <td>Zimbabwe</td>
      <td>...</td>
      <td>53.7</td>
      <td>14182079</td>
      <td>3</td>
      <td>2379907</td>
      <td>1</td>
      <td>4730503</td>
      <td>6416614</td>
      <td>12161598</td>
      <td>1014481</td>
      <td>1</td>
    </tr>
    <tr>
      <th>222133</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-15</td>
      <td>1</td>
      <td>256939</td>
      <td>21324395366</td>
      <td>0</td>
      <td>1</td>
      <td>Zimbabwe</td>
      <td>...</td>
      <td>53.7</td>
      <td>14182079</td>
      <td>3</td>
      <td>2379907</td>
      <td>1</td>
      <td>4730503</td>
      <td>6416614</td>
      <td>12161598</td>
      <td>1014481</td>
      <td>1</td>
    </tr>
    <tr>
      <th>222134</th>
      <td>ZWE</td>
      <td>-</td>
      <td>-</td>
      <td>2022-09-16</td>
      <td>1</td>
      <td>256939</td>
      <td>21324395366</td>
      <td>0</td>
      <td>1</td>
      <td>Zimbabwe</td>
      <td>...</td>
      <td>53.7</td>
      <td>14182079</td>
      <td>3</td>
      <td>2379907</td>
      <td>1</td>
      <td>4730503</td>
      <td>6416614</td>
      <td>12161598</td>
      <td>1014481</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div></div>
</div>
<p>This dataset has only country-level data and <code class="docutils literal notranslate"><span class="pre">geo</span></code> should be country name. We can select the followings as <code class="docutils literal notranslate"><span class="pre">geo</span></code> argument for EDA at a geospatial layer when we have adequate data.</p>
<ul class="simple">
<li><p>When <code class="docutils literal notranslate"><span class="pre">geo=None</span></code> or <code class="docutils literal notranslate"><span class="pre">geo=(None,)</span></code>, returns country-level data, assuming we have country/province/city as layers here.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">geo=(&quot;Japan&quot;,)</span></code> or <code class="docutils literal notranslate"><span class="pre">geo=&quot;Japan&quot;</span></code>, returns province-level data in Japan.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">geo=([&quot;Japan&quot;,</span> <span class="pre">&quot;UK&quot;],)</span></code>, returns province-level data in Japan and UK.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">geo=(&quot;Japan&quot;,</span> <span class="pre">&quot;Kanagawa&quot;)</span></code>, returns city-level data in Kanagawa/Japan.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">geo=(&quot;Japan&quot;,</span> <span class="pre">[&quot;Tokyo&quot;,</span> <span class="pre">&quot;Kanagawa&quot;])</span></code>, returns city-level data in Tokyo/Japan and Kanagawa/Japan.</p></li>
</ul>
<p>Additionally, we can create a choropleth map with a data at a geospatial layer on a date.</p>
<p>arguments of <code class="docutils literal notranslate"><span class="pre">DataEngineer().choropleth()</span></code>:</p>
<ul class="simple">
<li><p>geo (tuple(list[str] or tuple(str) or str) or str or None): location names to specify the layer or None (the top level)</p></li>
<li><p>variable (str): variable name to show</p></li>
<li><p>on (str or None): the date, like 22Jan2020, or None (the last date of each location)</p></li>
<li><p>title (str): title of the map</p></li>
<li><p>filename (str or None): filename to save the figure or None (display)</p></li>
<li><p>logscale (bool): whether convert the value to log10 scale values or not</p></li>
<li><p>directory (str): directory to save GeoJSON file of “Natural Earth” GitHub repository</p></li>
<li><p>natural_earth (str or None): title of GeoJSON file (without extension) of “Natural Earth” GitHub repository or None (automatically determined)</p></li>
<li><p>**kwargs: keyword arguments of the following classes and methods.</p>
<ul>
<li><p>matplotlib.pyplot.savefig(), matplotlib.pyplot.legend(), and</p></li>
<li><p>pandas.DataFrame.plot()</p></li>
</ul>
</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span><span class="o">.</span><span class="n">choropleth</span><span class="p">(</span><span class="n">geo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Choropleth map: Confirmed on the last date of records&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Retrieving GIS data from Natural Earth https://www.naturalearthdata.com/
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_data_engineering_21_1.png" src="_images/02_data_engineering_21_1.png" />
</div>
</div>
</div>
<div class="section" id="5.-Data-subsetting-for-a-location-and-data-complement">
<h2>5. Data subsetting for a location and data complement<a class="headerlink" href="#5.-Data-subsetting-for-a-location-and-data-complement" title="Permalink to this heading"></a></h2>
<p>The dataset is a geospatial time-series data. By selecting a location, the dataset will be converted to a time-series data, which is easier to analyze.</p>
<div class="section" id="5.1-Subsetting">
<h3>5.1 Subsetting<a class="headerlink" href="#5.1-Subsetting" title="Permalink to this heading"></a></h3>
<p>We will create a subset for selected location (eg. country, province/prefecture/state, city). Because the loaded dataset has country-level data, total values in United Kingdom (UK) on dates will be created here as an example.</p>
<p>Arguments of <code class="docutils literal notranslate"><span class="pre">DataEngineer().subset()</span></code>: * geo (tuple(list[str] or tuple(str) or str) or str or None): location names to filter or None (total at the top level) * start_date (str or None): start date, like 22Jan2020 * end_date (str or None): end date, like 01Feb2020 * variables (list[str] or None): list of variables to add or None (all available columns) * complement (bool): whether perform data complement or not, True as default * **Kwargs: keyword arguments for complement and default
values * recovery_period (int): expected value of recovery period [days], 17 * interval (int): expected update interval of the number of recovered cases [days], 2 * max_ignored (int): Max number of recovered cases to be ignored [cases], 100 * max_ending_unupdated (int): Max number of days to apply full complement, where max recovered cases are not updated [days], 14 * upper_limit_days (int): maximum number of valid partial recovery periods [days], 90 * lower_limit_days (int): minimum
number of valid partial recovery periods [days], 7 * upper_percentage (float): fraction of partial recovery periods with value greater than upper_limit_days, 0.5 * lower_percentage (float): fraction of partial recovery periods with value less than lower_limit_days, 0.5</p>
<div class="line-block">
<div class="line">NOTE:</div>
<div class="line">We can select the followings as <code class="docutils literal notranslate"><span class="pre">geo</span></code> argument for subsetting when we have adequate data. * When <code class="docutils literal notranslate"><span class="pre">geo=None</span></code> or <code class="docutils literal notranslate"><span class="pre">geo=(None,)</span></code>, returns total values of all country-level data, assuming we have country/province/city as layers here. * When <code class="docutils literal notranslate"><span class="pre">geo=(&quot;Japan&quot;,)</span></code> or <code class="docutils literal notranslate"><span class="pre">geo=&quot;Japan&quot;</span></code>, returns country-level data in Japan. * When <code class="docutils literal notranslate"><span class="pre">geo=([&quot;Japan&quot;,</span> <span class="pre">&quot;UK&quot;],)</span></code>, returns country-level data of Japan and UK. * When <code class="docutils literal notranslate"><span class="pre">geo=(&quot;Japan&quot;,</span> <span class="pre">&quot;Tokyo&quot;)</span></code>, returns province-level data of Tokyo/Japan. * When
<code class="docutils literal notranslate"><span class="pre">geo=(&quot;Japan&quot;,</span> <span class="pre">[&quot;Tokyo&quot;,</span> <span class="pre">&quot;Kanagawa&quot;])</span></code>, returns total values of province-level data of Tokyo/Japan and Kanagawa/Japan. * When <code class="docutils literal notranslate"><span class="pre">geo=(&quot;Japan&quot;,</span> <span class="pre">&quot;Kanagawa&quot;,</span> <span class="pre">&quot;Yokohama&quot;)</span></code>, returns city-level data of Yokohama/Kanagawa/Japan. * When <code class="docutils literal notranslate"><span class="pre">geo=((&quot;Japan&quot;,</span> <span class="pre">&quot;Kanagawa&quot;,</span> <span class="pre">[&quot;Yokohama&quot;,</span> <span class="pre">&quot;Kawasaki&quot;])</span></code>, returns total values of city-level data of Yokohama/Kanagawa/Japan and Kawasaki/Kanagawa/Japan.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Without complement</span>
<span class="n">without_df</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">status_dict</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">geo</span><span class="o">=</span><span class="s2">&quot;UK&quot;</span><span class="p">,</span> <span class="n">complement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">status_dict</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span><span class="n">without_df</span><span class="p">[[</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;Fatal&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">]],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;UK: records WITHOUT complement&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


{}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_data_engineering_25_1.png" src="_images/02_data_engineering_25_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># With complement (default)</span>
<span class="n">with_df</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">status_dict</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">geo</span><span class="o">=</span><span class="s2">&quot;Japan&quot;</span><span class="p">,</span> <span class="n">complement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">status_dict</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span><span class="n">with_df</span><span class="p">[[</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;Fatal&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">]],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;UK: records WITH complement&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
monotonic increasing complemented confirmed data and
monotonic increasing complemented fatal data and
partially complemented recovered data

{&#39;Full_recovered&#39;: False,
 &#39;Monotonic_confirmed&#39;: True,
 &#39;Monotonic_fatal&#39;: True,
 &#39;Monotonic_recovered&#39;: True,
 &#39;Partial_recovered&#39;: True}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_data_engineering_26_1.png" src="_images/02_data_engineering_26_1.png" />
</div>
</div>
</div>
<div class="section" id="5.2-Details-of-data-complement">
<h3>5.2 Details of data complement<a class="headerlink" href="#5.2-Details-of-data-complement" title="Permalink to this heading"></a></h3>
<p>When <code class="docutils literal notranslate"><span class="pre">complement=True</span></code> (default), data complement will be performed for confirmed/fatal/recovered data. This may be required for analysis because reported cumulative values sometimes show decreasing by changing accidentally for an example. Additionally, some countries, including UK, do not report the number of recovered cases.</p>
<p>The possible kinds of complement for each country are the following:</p>
<ul class="simple">
<li><p>“Monotonic_confirmed/fatal/recovered” (monotonic increasing complement) Force the variable show monotonic increasing.</p></li>
<li><p>“Full_recovered” (full complement of recovered data) Estimate the number of recovered cases using the value of estimated average recovery period.</p></li>
<li><p>“Partial_recovered” (partial complement of recovered data) When recovered values are not updated for some days, extrapolate the values.</p></li>
</ul>
</div>
<div class="section" id="5.3-Recovery-period">
<h3>5.3 Recovery period<a class="headerlink" href="#5.3-Recovery-period" title="Permalink to this heading"></a></h3>
<div class="line-block">
<div class="line">What is “recovery period”?</div>
<div class="line">We defined “recovery period” as the time period between case confirmation and recovery (as it is subjectively defined per country). We can estimate the mode value of recovery period with class method <code class="docutils literal notranslate"><span class="pre">DataEngineer.recovery_period(data)</span></code>.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jpn_df</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">geo</span><span class="o">=</span><span class="s2">&quot;Japan&quot;</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;Fatal&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">],</span> <span class="n">complement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">recovery_period</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">DataEngineer</span><span class="o">.</span><span class="n">recovery_period</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">jpn_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mode value of recovery period in Japan: </span><span class="si">{</span><span class="n">recovery_period</span><span class="si">}</span><span class="s2"> [days]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mode value of recovery period in Japan: 10 [days]
</pre></div></div>
</div>
<p>Details of recovery period calculation:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">jpn_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;diff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fatal&quot;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;diff&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">,</span> <span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;Number&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Days&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s2">&quot;Days&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;Number&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Variable&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">limit_area</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Elapsed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Recovered&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;diff&quot;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Elapsed&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="c1"># Calculate mode value</span>
<span class="n">mode_value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Elapsed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Elapsed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Histogram of elapsed days of recovery, mode value: </span><span class="si">{</span><span class="n">mode_value</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_data_engineering_31_0.png" src="_images/02_data_engineering_31_0.png" />
</div>
</div>
</div>
<div class="section" id="5.4-Alias-of-subsets">
<h3>5.4 Alias of subsets<a class="headerlink" href="#5.4-Alias-of-subsets" title="Permalink to this heading"></a></h3>
<p>We can register alias names of subsets with <code class="docutils literal notranslate"><span class="pre">DataEngineer().subset_alias()</span></code>.</p>
<div class="line-block">
<div class="line">Arguments:</div>
<div class="line">* alias (str or None): alias name or None (list-up alias names) * update (bool): force updating the alias when &#64;alias is not None * **kwargs: keyword arguments of covsirphy.DataEngineer().subset()</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Register</span>
<span class="n">sub1</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">subset_alias</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;UK_with&quot;</span><span class="p">,</span> <span class="n">geo</span><span class="o">=</span><span class="s2">&quot;UK&quot;</span><span class="p">,</span> <span class="n">complement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Retrieve with alias</span>
<span class="n">sub2</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">subset_alias</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;UK_with&quot;</span><span class="p">)</span>
<span class="c1"># Comparison</span>
<span class="n">sub1</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">sub2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="7.-EDA-of-subset">
<h2>7. EDA of subset<a class="headerlink" href="#7.-EDA-of-subset" title="Permalink to this heading"></a></h2>
<p>With explanatory data analysis, we will get the figure of datasets.</p>
<div class="section" id="7.1-Alias-of-variables">
<h3>7.1 Alias of variables<a class="headerlink" href="#7.1-Alias-of-variables" title="Permalink to this heading"></a></h3>
<p>We can specify variables with alias. For example, “CIFR” is equivalent to list <code class="docutils literal notranslate"><span class="pre">['Confirmed',</span> <span class="pre">'Infected',</span> <span class="pre">'Recovered',</span> <span class="pre">'Fatal']</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">geo</span><span class="o">=</span><span class="s2">&quot;Japan&quot;</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="s2">&quot;CIRF&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Confirmed</th>
      <th>Infected</th>
      <th>Recovered</th>
      <th>Fatal</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-09-13</th>
      <td>20221686</td>
      <td>1024930</td>
      <td>19153962</td>
      <td>42794</td>
    </tr>
    <tr>
      <th>2022-09-14</th>
      <td>20300387</td>
      <td>992294</td>
      <td>19265108</td>
      <td>42985</td>
    </tr>
    <tr>
      <th>2022-09-15</th>
      <td>20399933</td>
      <td>941199</td>
      <td>19415557</td>
      <td>43177</td>
    </tr>
    <tr>
      <th>2022-09-16</th>
      <td>20488312</td>
      <td>926698</td>
      <td>19518267</td>
      <td>43347</td>
    </tr>
    <tr>
      <th>2022-09-17</th>
      <td>20566116</td>
      <td>887237</td>
      <td>19635346</td>
      <td>43533</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>All aliases can be checked with <code class="docutils literal notranslate"><span class="pre">DataEngineer().variables_alias()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span><span class="o">.</span><span class="n">variables_alias</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;N&#39;: [&#39;Population&#39;],
 &#39;S&#39;: [&#39;Susceptible&#39;],
 &#39;T&#39;: [&#39;Tests&#39;],
 &#39;C&#39;: [&#39;Confirmed&#39;],
 &#39;I&#39;: [&#39;Infected&#39;],
 &#39;F&#39;: [&#39;Fatal&#39;],
 &#39;R&#39;: [&#39;Recovered&#39;],
 &#39;CFR&#39;: [&#39;Confirmed&#39;, &#39;Fatal&#39;, &#39;Recovered&#39;],
 &#39;CIRF&#39;: [&#39;Confirmed&#39;, &#39;Infected&#39;, &#39;Recovered&#39;, &#39;Fatal&#39;],
 &#39;SIRF&#39;: [&#39;Susceptible&#39;, &#39;Infected&#39;, &#39;Recovered&#39;, &#39;Fatal&#39;],
 &#39;CR&#39;: [&#39;Confirmed&#39;, &#39;Recovered&#39;]}
</pre></div></div>
</div>
<p>We can register new alias “p” with <code class="docutils literal notranslate"><span class="pre">[&quot;Tests&quot;,</span> <span class="pre">&quot;Confirmed&quot;,</span> <span class="pre">&quot;Positive_rate_%&quot;]</span></code> as an example.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Register new alias</span>
<span class="n">eng</span><span class="o">.</span><span class="n">variables_alias</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Tests&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;Positive_rate_%&quot;</span><span class="p">])</span>
<span class="c1"># Check the contents of an alias</span>
<span class="n">eng</span><span class="o">.</span><span class="n">variables_alias</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
<span class="c1"># Subsetting with the variable alias</span>
<span class="n">eng</span><span class="o">.</span><span class="n">subset_alias</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;jp&quot;</span><span class="p">,</span> <span class="n">geo</span><span class="o">=</span><span class="s2">&quot;Japan&quot;</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Tests</th>
      <th>Confirmed</th>
      <th>Positive_rate_%</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-09-13</th>
      <td>74136488</td>
      <td>20221686</td>
      <td>27.276293</td>
    </tr>
    <tr>
      <th>2022-09-14</th>
      <td>74386604</td>
      <td>20300387</td>
      <td>27.29038</td>
    </tr>
    <tr>
      <th>2022-09-15</th>
      <td>74581763</td>
      <td>20399933</td>
      <td>27.352441</td>
    </tr>
    <tr>
      <th>2022-09-16</th>
      <td>74773033</td>
      <td>20488312</td>
      <td>27.40067</td>
    </tr>
    <tr>
      <th>2022-09-17</th>
      <td>74962090</td>
      <td>20566116</td>
      <td>27.435356</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="7.2-Line-plot">
<h3>7.2 Line plot<a class="headerlink" href="#7.2-Line-plot" title="Permalink to this heading"></a></h3>
<p>Show data with line plot. We can select function <code class="docutils literal notranslate"><span class="pre">line_plot</span></code> or class <code class="docutils literal notranslate"><span class="pre">LinePlot</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">line_df</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">subset_alias</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;jp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>With function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">line_df</span><span class="p">[</span><span class="s2">&quot;Positive_rate_%&quot;</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Positive rate </span><span class="si">% i</span><span class="s2">n Japan&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Positive rate %&quot;</span><span class="p">,</span>
    <span class="n">math_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_data_engineering_44_0.png" src="_images/02_data_engineering_44_0.png" />
</div>
</div>
<p>With class:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">cs</span><span class="o">.</span><span class="n">LinePlot</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">lp</span><span class="p">:</span>
    <span class="n">lp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line_df</span><span class="p">[</span><span class="s2">&quot;Positive_rate_%&quot;</span><span class="p">])</span>
    <span class="n">lp</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Positive rate </span><span class="si">% i</span><span class="s2">n Japan&quot;</span>
    <span class="n">lp</span><span class="o">.</span><span class="n">x_axis</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">lp</span><span class="o">.</span><span class="n">y_axis</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Positive rate %&quot;</span><span class="p">,</span> <span class="n">math_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">lp</span><span class="o">.</span><span class="n">legend_hide</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_data_engineering_46_0.png" src="_images/02_data_engineering_46_0.png" />
</div>
</div>
</div>
<div class="section" id="7.3-Scatter-plot">
<h3>7.3 Scatter plot<a class="headerlink" href="#7.3-Scatter-plot" title="Permalink to this heading"></a></h3>
<p>Show data with scatter plot. We can select function <code class="docutils literal notranslate"><span class="pre">scatter_plot</span></code> or class <code class="docutils literal notranslate"><span class="pre">ScatterPlot</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc_df</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">subset_alias</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;jp&quot;</span><span class="p">)</span>
<span class="n">sc_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Tests&quot;</span><span class="p">:</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cs</span><span class="o">.</span><span class="n">scatter_plot</span><span class="p">(</span>
    <span class="n">sc_df</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Scatter plot&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Tests&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_data_engineering_49_0.png" src="_images/02_data_engineering_49_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">cs</span><span class="o">.</span><span class="n">ScatterPlot</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">sp</span><span class="p">:</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sc_df</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Scatter plot&quot;</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">x_axis</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Tests&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">y_axis</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">line_straight</span><span class="p">(</span><span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">p2</span><span class="o">=</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sc_df</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">sc_df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02_data_engineering_50_0.png" src="_images/02_data_engineering_50_0.png" />
</div>
</div>
<p>Thank you!</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01_data_preparation.html" class="btn btn-neutral float-left" title="Data preparation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="03_ode.html" class="btn btn-neutral float-right" title="SIR-derived ODE models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Hirokazu Takaya and CovsirPhy Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>